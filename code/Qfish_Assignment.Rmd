---
title: "QFISH Assignment"
author: "Alan Thomas Joshy"
date: "2024-05-17"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "../output/")
knitr::opts_chunk$set(echo = TRUE)
```

Load necessary package for the session:
```{r}
library(tidyverse)
```

Load the data csv file
```{r}
dat <- read_csv("../data/Qfish data/qfish_shark.csv", na = c("N/A",""))
dat
```

Now we have a tibble named "dat" which contains the data from 2001 to 2024 on the capture numbers of species of sharks deemed dangerous near popular Queensland beaches in order to reduce risk to humans. 

```{r}
#we named all the columns which were previously unnamed
names(dat)[names(dat) == "...1"] <- "Region"
names(dat)[names(dat) == "...4"] <- "col4"
names(dat)[names(dat) == "...6"] <- "col6"
names(dat)[names(dat) == "...28"] <- "col28"
dat
```

```{r}
#now we we'll remove the columns named col4 col6 and col28
neodata <- dat |> select(-col4, -col6 , -col28)
neodata
```





```{r}
newdata <- neodata |>
  pivot_longer(
    cols = starts_with("20"),
    names_to = "Year",
    values_to = "Captures"
  )
```

```{r}
newdata
```

I have noticed something in the data which needs to be tidied before we can visualize the data in an efficient manner.
the regions "Bribie Island" and "Sunshine Coast South", before 2017 were counted as one and the data from 2001 to 2016 is available for a region "Sunshine Coast South and Bribie Island". We will merge the data for "Bribie Island" and "Sunshine Coast South" from 2017 to 2024, into "Sunshine Coast South and Bribie Island" to make visualization easier. The original data file will be available in the following link: https://qfish.fisheries.qld.gov.au/query/0989b62c-8803-41d6-82a3-152fb0c416b3/table?customise=False 


trying to export the "newdata" tibble as an excel file to data wrangle a bit...

```{r}
#install.packages("writexl")

library(writexl)

write_xlsx(newdata, "../data/Qfish data/newdata.xlsx")
```



Loading the cleaned data
```{r}

library(readxl)

final_dat <- read_xlsx("../data/Qfish data/newdata_combined.xlsx")

final_dat
```





Visualizing the data with ggplot:
```{r}
plt <- ggplot2::ggplot(data = final_dat, aes(x = Year, y = Captures, colour = Region, group = Region)) +
  geom_line() +
  theme_minimal() +
  labs(title = "Sharks Captures in each region from 2001 to 2024", x = "Year", Y = "Captures") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
 
plt
```

now we'll try making a graph without the "Grand Total"

```{r}
fltrd_dta <- final_dat |> filter(Region != "Grand Total")

#plot graph with fltrd_dta
ggplot2::ggplot(data = fltrd_dta, aes(x = Year, y = Captures, colour = Region, group = Region)) +
  geom_line() +
  theme_minimal() +
  labs(title = "Sharks Captures in each region from 2001 to 2024", x = "Year", Y = "Captures") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

We will also make a graph showing just the "Grand Total"

```{r}
grand_total <- final_dat |> filter(Region == "Grand Total")

#plot graph with grand_total
ggplot2::ggplot(data = grand_total, aes(x = Year, y = Captures, colour = Region, group = Region)) +
  geom_line() +
  theme_minimal() +
  labs(title = "Sharks Captures in each region from 2001 to 2024", x = "Year", Y = "Captures") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

